{"version":3,"sources":["../source/Form.js"],"names":["Form","submit","bind","on_key_down","props","post","error","className","style","render_children","children","form_elements","Children","toArray","error_element","index","child","type","Error","cloneElement","key","Actions","insert_at","push","event","preventDefault","busy","wait","keyCode","cancel","propTypes","func","oneOfType","string","bool","node","isRequired","object","defaultProps","rrui__modal","context","register_form","unregister_form","close_if_not_busy","closeLabel","contextTypes"],"mappings":";;;;;;;;AAAA;;;;AACA;;;;AACA;;;;AAEA;;;;;;;;;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;IACqBA,I;;;AAsCpB,iBACA;AAAA;;AAAA;;AAGC,QAAKC,MAAL,GAAmB,MAAKA,MAAL,CAAYC,IAAZ,OAAnB;AACA,QAAKC,WAAL,GAAmB,MAAKA,WAAL,CAAiBD,IAAjB,OAAnB;AAJD;AAKC;;;;2BAGD;AAAA,gBAC2C,KAAKE,KADhD;AAAA,OACSC,IADT,UACSA,IADT;AAAA,OACeC,KADf,UACeA,KADf;AAAA,OACsBC,SADtB,UACsBA,SADtB;AAAA,OACiCC,KADjC,UACiCA,KADjC;;;AAGC,UACC;AAAA;AAAA;AACC,eAAW,KAAKP,MADjB;AAEC,gBAAY,KAAKE,WAFlB;AAGC,aAASE,IAHV;AAIC,aAAO,MAJR;AAKC,gBAAY,0BAAW,YAAX,EAAyBE,SAAzB,CALb;AAMC,YAAQC,KANT;AAOC,qBAPD;AASG,SAAKC,eAAL,CAAqBH,KAArB;AATH,IADD;AAaA;;AAED;;;;kCACgBA,K,EAChB;AAAA,OACSI,QADT,GACsB,KAAKN,KAD3B,CACSM,QADT;;;AAGC,OAAMC,gBAAgB,gBAAMC,QAAN,CAAeC,OAAf,CAAuBH,QAAvB,CAAtB;;AAEA;AACA,OAAIJ,KAAJ,EACA;AACC;AACA,QAAIQ,gBAAgB;AAAC,SAAD,CAAM,KAAN;AAAA,OAAY,KAAI,YAAhB;AAA+BR;AAA/B,KAApB;;AAEA;AACA;AACA,QAAIS,QAAQ,CAAZ;AACA,yBAAoBJ,aAApB,kHACA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA,SADWK,KACX;;AACC,SAAIA,MAAMC,IAAN,KAAejB,KAAKkB,KAAxB,EACA;AACCP,oBAAcI,KAAd,IAAuB,gBAAMI,YAAN,CAAmBH,KAAnB,EAA0B,EAAEI,KAAK,YAAP,EAA1B,EAAiDd,KAAjD,CAAvB;AACAQ,sBAAgB,IAAhB;AACA;AACA;;AAED,SAAIE,MAAMC,IAAN,KAAejB,KAAKqB,OAAxB,EACA;AACCV,oBAAcW,SAAd,CAAwBP,KAAxB,EAA+BD,aAA/B;AACAA,sBAAgB,IAAhB;AACA;AACA;;AAEDC;AACA;;AAED,QAAID,aAAJ,EACA;AACCH,mBAAcY,IAAd,CAAmBT,aAAnB;AACA;AACD;;AAED,UAAOH,aAAP;AACA;;;yBAEMa,K,EACP;AACC,OAAIA,KAAJ,EACA;AACCA,UAAMC,cAAN;AACA;;AAJF,iBAMgC,KAAKrB,KANrC;AAAA,OAMSsB,IANT,WAMSA,IANT;AAAA,OAMeC,IANf,WAMeA,IANf;AAAA,OAMqB1B,MANrB,WAMqBA,MANrB;;AAQC;AACA;AACA;;AACA,OAAIyB,QAAQC,IAAZ,EACA;AACC;AACA;;AAED,OAAI1B,MAAJ,EACA;AACC,WAAOA,QAAP;AACA;AACD;;;8BAEWuB,K,EACZ;AACC;AACA,OAAIA,MAAMI,OAAN,KAAkB,EAAtB,EACA;AAAA,QACSC,MADT,GACoB,KAAKzB,KADzB,CACSyB,MADT;;;AAGC,QAAIA,MAAJ,EACA;AACCA;AACA;;AAEDL,UAAMC,cAAN;AACA;AACD;;;;;;AAlJmBzB,I,CAEb8B,S,GACP;AACC;AACA7B,SAAc,oBAAU8B,IAFzB;;AAIC;AACAF,SAAc,oBAAUE,IALzB;;AAOC;AACA;AACA;AACAzB,QAAc,oBAAU0B,SAAV,CAAoB,CAAC,oBAAUC,MAAX,EAAmB,oBAAUC,IAA7B,EAAmC,oBAAUC,IAA7C,CAApB,CAVf;;AAYC;AACA;AACA;AACA9B,OAAc,oBAAU4B,MAfzB;;AAiBC;AACAP,OAAc,oBAAUQ,IAAV,CAAeE,UAlB9B;AAmBC;AACAT,OAAc,oBAAUO,IAAV,CAAeE,UApB9B;;AAsBC;AACA7B,YAAc,oBAAU0B,MAvBzB;;AAyBC;AACAzB,QAAc,oBAAU6B;AA1BzB,C;AAHoBrC,I,CAgCbsC,Y,GACP;AACCZ,OAAO,KADR;AAECC,OAAO;AAFR,C;kBAjCoB3B,I;;;AAqJrBA,KAAKkB,KAAL,GAAa,iBACb;AAAA,KADwBR,QACxB,SADwBA,QACxB;;AACC,QACC;AAAA;AAAA,IAAK,WAAU,mBAAf;AACGA;AADH,EADD;AAKA,CAPD;;AASA;AACA;AACA;AACAV,KAAKqB,OAAL;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA,uCAGC;AAAA,OACSkB,WADT,GACyB,KAAKC,OAD9B,CACSD,WADT;;;AAGC,OAAIA,WAAJ,EACA;AACCA,gBAAYE,aAAZ;AACA;AACD;AAVF;AAAA;AAAA,yCAaC;AAAA,OACSF,WADT,GACyB,KAAKC,OAD9B,CACSD,WADT;;;AAGC,OAAIA,WAAJ,EACA;AACCA,gBAAYG,eAAZ;AACA;AACD;AApBF;AAAA;AAAA,2BAuBC;AAAA,iBACwC,KAAKtC,KAD7C;AAAA,OACSM,QADT,WACSA,QADT;AAAA,OACmBH,SADnB,WACmBA,SADnB;AAAA,OAC8BC,KAD9B,WAC8BA,KAD9B;AAAA,OAES+B,WAFT,GAEyB,KAAKC,OAF9B,CAESD,WAFT;;;AAIC,UACC;AAAA;AAAA;AACC,gBAAY,0BAAW,qBAAX,EAAkChC,SAAlC,CADb;AAEC,YAAQC,KAFT;AAGG+B,mBACD;AAAA;AAAA,OAAQ,QAASA,YAAYI,iBAA7B;AACGJ,iBAAYK;AADf,KAJF;AAQGlC;AARH,IADD;AAYA;AAvCF;;AAAA;AAAA;;AA0CAV,KAAKqB,OAAL,CAAawB,YAAb,GACA;AACCN,cAAc,oBAAUF;AADzB,CADA","file":"Form.js","sourcesContent":["import React, { Component } from 'react'\r\nimport PropTypes from 'prop-types'\r\nimport classNames from 'classnames'\r\n\r\nimport Button from './Button'\r\n\r\n// Prevents `<form/> submission when `busy`/`wait` is `true`.\r\n// And also inserts `<Form.Error/>` when `error` is passed.\r\n// Using `Component` here instead of `PureComponent`\r\n// because `<Form.Actions>` depends on `context` and therefore\r\n// should be rerendered even if the `props` haven't changed.\r\n// And probably that was also why it would keep displaying an old error\r\n// (and not resetting it for some reason).\r\nexport default class Form extends Component\r\n{\r\n\tstatic propTypes =\r\n\t{\r\n\t\t// `onSubmit` handler\r\n\t\tsubmit      : PropTypes.func,\r\n\r\n\t\t// On `Escape` keydown handler\r\n\t\tcancel      : PropTypes.func,\r\n\r\n\t\t// `error` can be passed for non-javascript old-school forms.\r\n\t\t// e.g. when a form submitted via HTTP POST request had an error,\r\n\t\t// then this error is rendered as part of the form.\r\n\t\terror       : PropTypes.oneOfType([PropTypes.string, PropTypes.bool, PropTypes.node]),\r\n\r\n\t\t// The HTML form `action` attribute,\r\n\t\t// i.e. the URL to which the form will be posted\r\n\t\t// in case of a non-javascript old-school POST submission.\r\n\t\tpost        : PropTypes.string,\r\n\r\n\t\t// Is form submission in progress\r\n\t\tbusy        : PropTypes.bool.isRequired,\r\n\t\t// `wait` is an alias for `busy`\r\n\t\twait        : PropTypes.bool.isRequired,\r\n\r\n\t\t// CSS class\r\n\t\tclassName   : PropTypes.string,\r\n\r\n\t\t// CSS style object\r\n\t\tstyle       : PropTypes.object\r\n\t}\r\n\r\n\tstatic defaultProps =\r\n\t{\r\n\t\tbusy : false,\r\n\t\twait : false\r\n\t}\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper()\r\n\r\n\t\tthis.submit      = this.submit.bind(this)\r\n\t\tthis.on_key_down = this.on_key_down.bind(this)\r\n\t}\r\n\r\n\trender()\r\n\t{\r\n\t\tconst { post, error, className, style } = this.props\r\n\r\n\t\treturn (\r\n\t\t\t<form\r\n\t\t\t\tonSubmit={ this.submit }\r\n\t\t\t\tonKeyDown={ this.on_key_down }\r\n\t\t\t\taction={ post }\r\n\t\t\t\tmethod=\"POST\"\r\n\t\t\t\tclassName={ classNames('rrui__form', className) }\r\n\t\t\t\tstyle={ style }\r\n\t\t\t\tnoValidate>\r\n\r\n\t\t\t\t{ this.render_children(error) }\r\n\t\t\t</form>\r\n\t\t)\r\n\t}\r\n\r\n\t// Adds `error` element to the form\r\n\trender_children(error)\r\n\t{\r\n\t\tconst { children } = this.props\r\n\r\n\t\tconst form_elements = React.Children.toArray(children)\r\n\r\n\t\t// Insert `error` element\r\n\t\tif (error)\r\n\t\t{\r\n\t\t\t// Will be set to `null` upon insertion\r\n\t\t\tlet error_element = <Form.Error key=\"form-error\">{ error }</Form.Error>\r\n\r\n\t\t\t// Show form error above form actions,\r\n\t\t\t// so that the error will be visible and won't be overlooked.\r\n\t\t\tlet index = 0\r\n\t\t\tfor (const child of form_elements)\r\n\t\t\t{\r\n\t\t\t\tif (child.type === Form.Error)\r\n\t\t\t\t{\r\n\t\t\t\t\tform_elements[index] = React.cloneElement(child, { key: 'form-error' }, error)\r\n\t\t\t\t\terror_element = null\r\n\t\t\t\t\tbreak\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (child.type === Form.Actions)\r\n\t\t\t\t{\r\n\t\t\t\t\tform_elements.insert_at(index, error_element)\r\n\t\t\t\t\terror_element = null\r\n\t\t\t\t\tbreak\r\n\t\t\t\t}\r\n\r\n\t\t\t\tindex++\r\n\t\t\t}\r\n\r\n\t\t\tif (error_element)\r\n\t\t\t{\r\n\t\t\t\tform_elements.push(error_element)\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn form_elements\r\n\t}\r\n\r\n\tsubmit(event)\r\n\t{\r\n\t\tif (event)\r\n\t\t{\r\n\t\t\tevent.preventDefault()\r\n\t\t}\r\n\r\n\t\tconst { busy, wait, submit } = this.props\r\n\r\n\t\t// Prevent form double submit\r\n\t\t// (because not only buttons submit a form,\r\n\t\t//  therefore just disabling buttons is not enough).\r\n\t\tif (busy || wait)\r\n\t\t{\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tif (submit)\r\n\t\t{\r\n\t\t\treturn submit()\r\n\t\t}\r\n\t}\r\n\r\n\ton_key_down(event)\r\n\t{\r\n\t\t// Cancel editing on \"Escape\" key\r\n\t\tif (event.keyCode === 27)\r\n\t\t{\r\n\t\t\tconst { cancel } = this.props\r\n\r\n\t\t\tif (cancel)\r\n\t\t\t{\r\n\t\t\t\tcancel()\r\n\t\t\t}\r\n\r\n\t\t\tevent.preventDefault()\r\n\t\t}\r\n\t}\r\n}\r\n\r\nForm.Error = function({ children })\r\n{\r\n\treturn (\r\n\t\t<div className=\"rrui__form__error\">\r\n\t\t\t{ children }\r\n\t\t</div>\r\n\t)\r\n}\r\n\r\n// Using `Component` here instead of `PureComponent`\r\n// because it depends on `context` and therefore should be\r\n// rerendered even if the `props` haven't changed.\r\nForm.Actions = class Actions extends Component\r\n{\r\n\tcomponentWillMount()\r\n\t{\r\n\t\tconst { rrui__modal } = this.context\r\n\r\n\t\tif (rrui__modal)\r\n\t\t{\r\n\t\t\trrui__modal.register_form()\r\n\t\t}\r\n\t}\r\n\r\n\tcomponentWillUnmount()\r\n\t{\r\n\t\tconst { rrui__modal } = this.context\r\n\r\n\t\tif (rrui__modal)\r\n\t\t{\r\n\t\t\trrui__modal.unregister_form()\r\n\t\t}\r\n\t}\r\n\r\n\trender()\r\n\t{\r\n\t\tconst { children, className, style } = this.props\r\n\t\tconst { rrui__modal } = this.context\r\n\r\n\t\treturn (\r\n\t\t\t<div\r\n\t\t\t\tclassName={ classNames('rrui__form__actions', className) }\r\n\t\t\t\tstyle={ style }>\r\n\t\t\t\t{ rrui__modal &&\r\n\t\t\t\t\t<Button action={ rrui__modal.close_if_not_busy }>\r\n\t\t\t\t\t\t{ rrui__modal.closeLabel }\r\n\t\t\t\t\t</Button>\r\n\t\t\t\t}\r\n\t\t\t\t{ children }\r\n\t\t\t</div>\r\n\t\t)\r\n\t}\r\n}\r\n\r\nForm.Actions.contextTypes =\r\n{\r\n\trrui__modal : PropTypes.object\r\n}"]}